<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>test</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: #222;
    }
    /* 5å€‹ã®ãƒªãƒ¼ãƒ«ã‚’æ¨ªä¸¦ã³ã«ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ */
    .slots-container {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    /* å„ã‚¹ãƒ­ãƒƒãƒˆæ ï¼šã‚«ãƒ¼ãƒ‰ã‚µã‚¤ã‚º200Ã—200ã«åˆã‚ã›ã‚‹ */
    .slot {
      /*width: 210px; */  /* 200pxã‚«ãƒ¼ãƒ‰å¹… + 10pxä½™è£• */

width: 300px;

      height: 400px;
      overflow: hidden;
      border: 3px solid #fff;
      position: relative;
      background: black;
      perspective: 800px;
    }
    /* ç”»åƒãƒªã‚¹ãƒˆ */
    .slot-inner {
      display: flex;
      position: absolute;
      top: 0;
      left: 0;
    }
    /* å„ã‚«ãƒ¼ãƒ‰ï¼šã‚µã‚¤ã‚º200Ã—200ã€ä½™ç™½20px */
    .card {
      width: 300px;
      height: 400px;
      /* margin-right: 20px;*/
    margin-right: 0px;
 margin-left: 0px;

      transform-origin: center center;
    }
    button {
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
    }
  </style>




  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
    .particle {
      position: absolute;
      width: 20px;
      height: 20px;
      background: radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,200,100,0.8) 50%, rgba(255,255,255,0) 100%);
      clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
      pointer-events: none;
      opacity: 1;
    }
  </style>

</head>
<body>


  <div id="particle-container"></div>



  <!-- 5å€‹ã®ãƒªãƒ¼ãƒ«ã‚’æ¨ªä¸¦ã³ã«é…ç½® -->
  <div class="slots-container">


    <div class="slot">
      <div class="slot-inner">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
      </div>
    </div>


    <div class="slot">
      <div class="slot-inner">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
      </div>
    </div>

        <div class="slot">
      <div class="slot-inner">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
      </div>
    </div>

        <div class="slot">
      <div class="slot-inner">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
      </div>
    </div>

        <div class="slot">
      <div class="slot-inner">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
        <img src="a.jpg" class="card">
        <img src="b.jpg" class="card">
        <img src="c.jpg" class="card">
        <img src="d.jpg" class="card">
        <img src="e.jpg" class="card">
      </div>
    </div>





  </div>
  <button id="startButton">start</button>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/gsap.min.js"></script>
  <script>
    // helper: modNeg() ã‚’ä½¿ã£ã¦ x ã‚’å¸¸ã« -totalWidth ï½ 0 ã®ç¯„å›²ã«åã‚ã‚‹
    function modNeg(x, m) {
      return ((x % m) + m) % m - m;
    }
    
    // å…±é€šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    // ã‚«ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºï¼‹ä½™ç™½: 200px + 20px = 220px
    //const cardWidth = 220; 
    const cardWidth = 300; 
    const numCards = 5; // 5ç¨®é¡ã®ã‚«ãƒ¼ãƒ‰
    const totalWidth = cardWidth * numCards; // 220 * 5 = 1100px
    // ã‚¹ãƒ­ãƒƒãƒˆæ ã¯å¹…210px â†’ ä¸­å¤®ã¯105px
    
    // å„ãƒªãƒ¼ãƒ«ã®æƒ…å ±ã‚’ä¿æŒã™ã‚‹é…åˆ—
    const reels = [];
    const slotElements = document.querySelectorAll('.slot');
    slotElements.forEach(slot => {
      const reel = slot.querySelector('.slot-inner');
      reels.push({
        reel: reel,
        tween: null,
        targetIndex: null,
        stopped: false
      });
      
      // åˆæœŸåŒ–æ™‚ã«å††æŸ±é¢¨ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’é©ç”¨
      updateCylindricalTransform(reel);
    });
    
    const button = document.getElementById('startButton');
    let isRunning = false;
    
    // å††æŸ±é¢¨å¤‰å½¢ï¼šå„ã‚«ãƒ¼ãƒ‰ã« rotateY ã¨ scale ã‚’é©ç”¨
    function updateCylindricalTransform(reel) {
      //const slotCenter = 105; // ã‚¹ãƒ­ãƒƒãƒˆã®ä¸­å¤®
 const slotCenter = 200; // ã‚¹ãƒ­ãƒƒãƒˆã®ä¸­å¤®
      const cards = reel.querySelectorAll('.card');
      let currentX = gsap.getProperty(reel, "x") || 0;
      
      // ã™ã¹ã¦ã®ã‚«ãƒ¼ãƒ‰ã‚’å‡¦ç†ï¼ˆä¸¡æ–¹ã®ã‚»ãƒƒãƒˆï¼‰
      cards.forEach((card, index) => {
        let cardX = currentX + index * cardWidth;
        let cardCenter = cardX + cardWidth / 2;
        let diff = cardCenter - slotCenter;
        let normalized = diff / (slotCenter * 1.5); // è¦–é‡è§’ã‚’èª¿æ•´
        
        // å€¤ã‚’ -1 ã‹ã‚‰ 1 ã®ç¯„å›²ã«åã‚ã‚‹
        normalized = Math.max(-1, Math.min(1, normalized));
        
        const maxAngle = 35; // æœ€å¤§å›è»¢è§’åº¦35Â°
        let angle = normalized * maxAngle;
        
        // ã‚¹ã‚±ãƒ¼ãƒ«ã‚’èª¿æ•´ï¼ˆä¸­å¤®ã¯1ã€ç«¯ã¯ç´„0.8ï¼‰
        let scale = 1 - 0.2 * Math.abs(normalized);
        
        // é€æ˜åº¦ã‚‚è¿½åŠ ï¼ˆå®Œå…¨ã«è¦‹ãˆãªããªã‚‰ãªã„ã‚ˆã†æœ€å°å€¤ã‚’è¨­å®šï¼‰
        let opacity = 1 - 0.5 * Math.abs(normalized);
    

        gsap.set(card, {
          transform: `rotateY(${angle}deg) scale(${scale})`,
          opacity: opacity
        });
      });
    }
    




    // å„ãƒªãƒ¼ãƒ«ã®å›è»¢é–‹å§‹
    function startReels() {
      if (isRunning) return;
      isRunning = true;
      button.disabled = true;
      


      reels.forEach(reelObj => {
        // å„ãƒªãƒ¼ãƒ«ã§ãƒ©ãƒ³ãƒ€ãƒ ã« chosen ã‚«ãƒ¼ãƒ‰ï¼ˆ0ã€œ4ï¼‰ã‚’æ±ºå®š
        reelObj.targetIndex = Math.floor(Math.random() * numCards);
        reelObj.stopped = false;
        

//reelObj.targetIndex = 4;


        // ç¾åœ¨ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢
        if (reelObj.tween) reelObj.tween.kill();
        
        // åˆæœŸä½ç½®ã‚’è¨­å®šï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ­ã®ç¯„å›²å†…ã«ï¼‰
        let currentX = gsap.getProperty(reelObj.reel, "x") || 0;

currentX = 0;

        currentX = modNeg(currentX, totalWidth);
        gsap.set(reelObj.reel, { x: currentX });
        
        // æ–°ã—ã„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹
        reelObj.tween = gsap.to(reelObj.reel, {
          x: `-=${totalWidth * 3}`, // 3å‘¨åˆ†å›è»¢
          duration: 2.0,
          ease: "linear",
          repeat: -1,
          modifiers: {
            x: (x) => `${modNeg(parseFloat(x), totalWidth)}px`
          },
          onUpdate: () => updateCylindricalTransform(reelObj.reel)
        });
      });
      
      // å·¦ã‹ã‚‰é †ã«ã€600msãšã¤é…ã‚Œã¦å„ãƒªãƒ¼ãƒ«ã‚’åœæ­¢
      reels.forEach((reelObj, i) => {
        setTimeout(() => stopReel(reelObj), 3000 + i * 600);
      });
    }
    
    // å„ãƒªãƒ¼ãƒ«ã®åœæ­¢å‡¦ç†
    function stopReel(reelObj) {
      if (!reelObj.tween) return;
      
      // ç¾åœ¨ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢
      reelObj.tween.kill();
      reelObj.tween = null;
      
      // ç¾åœ¨ä½ç½®ã‚’æ­£è¦åŒ–
      let currentX = gsap.getProperty(reelObj.reel, "x");
      currentX = modNeg(currentX, totalWidth);
      

//console.log("currentX : " + currentX); 

      // ç›®æ¨™ä½ç½®ï¼šé¸æŠã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ãŒã‚¹ãƒ­ãƒƒãƒˆã®ä¸­å¤®ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†èª¿æ•´
      // ã‚¹ãƒ­ãƒƒãƒˆä¸­å¤®(105px)ã«ã‚«ãƒ¼ãƒ‰ã®ä¸­å¤®(100px)ãŒæ¥ã‚‹ã‚ˆã†è¨ˆç®—
      // 105 - 100 = 5px ã‚ªãƒ•ã‚»ãƒƒãƒˆ
      //let finalTarget = 5 - reelObj.targetIndex * cardWidth;
      let finalTarget =  reelObj.targetIndex * cardWidth;

      // å¸¸ã«å‰æ–¹ã«é€²ã‚€ã‚ˆã†è·é›¢ã‚’è¨ˆç®—
      let distanceToTarget = finalTarget - currentX;
      if (distanceToTarget > 0) {
        finalTarget -= totalWidth;
        distanceToTarget = finalTarget - currentX;
      }
      
      // è·é›¢ãŒçŸ­ã™ãã‚‹å ´åˆã¯ã‚‚ã†1å‘¨
      if (Math.abs(distanceToTarget) < cardWidth * 2) {
        finalTarget -= totalWidth;
      }
    
      // ã‚†ã‚‰ã—åŠ¹æœã®ç¢ºç‡ï¼ˆtargetIndexãŒå¤§ãã„ã»ã©é«˜ç¢ºç‡ï¼‰
      let overshootProbability = 0.3 + 0.1 * reelObj.targetIndex;
      
   if (Math.random() < overshootProbability) {
//if (true) {

        // ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ¥ãƒ¼ãƒˆã™ã‚‹ã‚»ãƒ«æ•°ï¼ˆ2ã€œ4ï¼‰
        //let overshootCells = 2 + Math.floor(Math.random() * 1);


//let overshootCells = 1 - Math.floor(Math.random() * 2);


let overshootCells = 1 -  Math.floor(Math.random() * 3);

//overshootCells = -1;


//console.log(    overshootCells ); 



        // æœ€çµ‚ä½ç½®ã‹ã‚‰overshootCellsåˆ†å…ˆ
        let newFinalTarget = finalTarget - overshootCells * cardWidth;
        
        // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã§ãƒã‚§ãƒ¼ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        let tl = gsap.timeline({
          onUpdate: () => updateCylindricalTransform(reelObj.reel),
          onComplete: () => {
            reelObj.stopped = true;
            checkAllStopped();
          }
        });
        

        /*
        // ã¾ãšä½é€ŸçŠ¶æ…‹ã«ç§»è¡Œ
        tl.to(reelObj.reel, {
          x: newFinalTarget + cardWidth * 0.7, // 70%åœ°ç‚¹ã¾ã§
          duration: 1.8,
          ease: "slow(0.5, 0.3, false)"
        })
        // ã•ã‚‰ã«ä½é€Ÿã§æˆ»ã‚‹
        .to(reelObj.reel, {
          x: finalTarget,
          duration: 1.0,
          ease: "power1.inOut"
        });
        */

let add = 0;
if(overshootCells == 1)
  add = cardWidth * 0.5;
else if(overshootCells == -1)
add = cardWidth * -0.5;

        // ã¾ãšä½é€ŸçŠ¶æ…‹ã«ç§»è¡Œ
        tl.to(reelObj.reel, {
          x: newFinalTarget + add, 
          //x: newFinalTarget + cardWidth * 0.5, // 70%åœ°ç‚¹ã¾ã§
          duration: 1.8,
          ease: "slow(0.5, 0.3, false)",
        })
        // ã•ã‚‰ã«ä½é€Ÿã§æˆ»ã‚‹
        .to(reelObj.reel, {
          x: finalTarget,
          duration: 1.0,
          ease: "power1.inOut",
           delay: 0.5
        });
   

      } else {
        // é€šå¸¸åœæ­¢ï¼ˆæ¸›é€Ÿã—ã¦æ­¢ã¾ã‚‹ï¼‰
        gsap.to(reelObj.reel, {
          x: finalTarget,
          duration: 1.5,
          ease: "power2.out",
          onUpdate: () => updateCylindricalTransform(reelObj.reel),
          onComplete: () => {
            reelObj.stopped = true;
            checkAllStopped();
          }
        });
      }











    }
    
    // ã™ã¹ã¦ã®ãƒªãƒ¼ãƒ«ãŒåœæ­¢ã—ãŸã‹ç¢ºèª
    function checkAllStopped() {
      if (reels.every(r => r.stopped)) {
        isRunning = false;
        button.disabled = false;
      }
    }
    
    // åˆæœŸåŒ–ï¼ˆã™ã¹ã¦ã®ãƒªãƒ¼ãƒ«ã«å††æŸ±é¢¨ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’é©ç”¨ï¼‰
    reels.forEach(reelObj => {
      updateCylindricalTransform(reelObj.reel);
    });
    
    button.addEventListener("click", startReels);
  </script>








<script>
  // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”¨ã‚³ãƒ³ãƒ†ãƒŠ
  const particleContainer = document.getElementById("particle-container");

  function createParticle() {
    const wrapper = document.createElement("div");
    wrapper.style.position = "absolute";
    wrapper.style.pointerEvents = "none";
    
    const baseParticle = document.createElement("div");
    baseParticle.classList.add("particle");

    // ğŸ”¹ 360Â° ãƒ©ãƒ³ãƒ€ãƒ ãªè§’åº¦ã§å›è»¢
    const randomRotation = Math.random() * 360;
    baseParticle.style.transform = `rotate(${randomRotation}deg)`;
    
    wrapper.appendChild(baseParticle);
    particleContainer.appendChild(wrapper); 

    // åˆæœŸä½ç½®ï¼ˆç”»é¢ä¸‹å…¨ä½“ï¼‰
    const startX = Math.random() * window.innerWidth - 100;
    const startY = window.innerHeight + 10;
    wrapper.style.left = `${startX}px`;
    wrapper.style.top = `${startY}px`;

    // ãƒ©ãƒ³ãƒ€ãƒ ãªç§»å‹•æ–¹å‘ï¼ˆå³ä¸Šã¸å‘ã‹ã†ï¼‰
    const targetX = startX + Math.random() * 200 + 100;
    const targetY = startY - (window.innerHeight * 0.8);
    
    const duration = Math.random() * 3 + 5; // ç§»å‹•ã®å…¨ä½“æ™‚é–“

    // ğŸ”¹ ãƒ¡ã‚¤ãƒ³ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ï¼ˆã‚†ã£ãã‚Šæ¶ˆãˆã‚‹ï¼‰
    gsap.to(baseParticle, {
      x: targetX - startX,
      y: targetY - startY,
      scale: Math.random() * 1.5 + 0.5,
      opacity: 0,
      duration: duration,
      ease: "power1.out",
    });

    // ğŸ”¹ ç¬ãã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆ2é‡æ§‹é€ ã®å¤–å´ï¼‰
    gsap.to(wrapper, {
      opacity: Math.random() * 0.5 + 0.2 , // 0.3ï½0.8ã®ç¯„å›²ã§å¤‰åŒ–
      duration: Math.random() * 0.5+ 0.2 , // 0.3ï½0.8ç§’ã§å¤‰åŒ–
      repeat: Math.floor(duration / 0.8), // æŒç¶šæ™‚é–“ã«åˆã‚ã›ãŸå›æ•°ã§ç¹°ã‚Šè¿”ã™
      yoyo: true, // è¡Œã£ãŸã‚Šæ¥ãŸã‚Šï¼ˆç¬ãã™ã‚‹æ„Ÿã˜ï¼‰
      ease: "power1.inOut",
    });

gsap.to(baseParticle, {
  filter: `hue-rotate(${Math.random() * 60 + 30}deg)`, // Â±30åº¦ã®ç¯„å›²ã§è‰²ç›¸ã‚’å¤‰ãˆã‚‹
  duration: Math.random() * 0.8 + 0.5, // è‰²å¤‰åŒ–ã®æ™‚é–“
  repeat: Math.floor(duration / 1), // æŒç¶šæ™‚é–“ã«åˆã‚ã›ãŸå›æ•°ã§ç¹°ã‚Šè¿”ã™
  yoyo: true, // è¡Œã£ãŸã‚Šæ¥ãŸã‚Šï¼ˆè‰²ãŒäº¤äº’ã«å¤‰ã‚ã‚‹ï¼‰
  ease: "power1.inOut",
});


  }

  function startParticleEffect() {
    setInterval(createParticle, 100);
  }

  startParticleEffect();
</script>








</body>





</html>


